"use client";

import * as React from "react";

export type Severity = "low" | "medium" | "high";

export type VulnerabilityCardData = {
  title: string;
  category?: string;
  message: string;
  severity: Severity;
  filePath: string;
  line: number;
};

export type VulnerabilityCardProps = {
  data: VulnerabilityCardData;
  selected?: boolean;
  onClick?: () => void;
  className?: string;
};

function cx(...classes: Array<string | false | null | undefined>) {
  return classes.filter(Boolean).join(" ");
}

function severityPillClasses(severity: Severity) {
  switch (severity) {
    case "low":
      return "bg-[rgb(var(--sev-low-rgb)/0.18)] text-[var(--sev-low)]";
    case "medium":
      return "bg-[rgb(var(--sev-medium-rgb)/0.18)] text-[var(--sev-medium)]";
    case "high":
      return "bg-[rgb(var(--sev-high-rgb)/0.18)] text-[var(--sev-high)]";
  }
}

function severityLabel(severity: Severity) {
  switch (severity) {
    case "low":
      return "Low";
    case "medium":
      return "Medium";
    case "high":
      return "High";
  }
}

function FileIcon() {
  return (
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M14 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8l-5-6Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinejoin="round"
      />
      <path d="M14 2v6h6" stroke="currentColor" strokeWidth="2" strokeLinejoin="round" />
      <path
        d="M9 14l-2 2 2 2M15 14l2 2-2 2"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}

function CautionIcon() {
  return (
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path
        d="M10.29 3.86 2.89 16.66A2 2 0 0 0 4.6 20h14.8a2 2 0 0 0 1.71-3.34l-7.4-12.8a2 2 0 0 0-3.42 0Z"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinejoin="round"
      />
      <path d="M12 9v4" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
      <path d="M12 17h.01" stroke="currentColor" strokeWidth="2" strokeLinecap="round" />
    </svg>
  );
}

export function VulnerabilityCard({
  data,
  selected = false,
  onClick,
  className,
}: VulnerabilityCardProps) {
  return (
    <button
      type="button"
      onClick={onClick}
      aria-pressed={selected}
      className={cx(
        // Less rounded corners + tighter feel
        "w-full text-left border rounded-md transition",
        "px-6 py-4",
        "focus:outline-none focus-visible:ring-2 focus-visible:ring-[rgb(var(--blue-rgb)/0.50)]",

        // Selected background noticeably different (matches your 2nd screenshot)
        selected
          ? "border-[rgb(var(--foreground-rgb)/0.60)] bg-[rgb(var(--foreground-rgb)/0.12)]"
          : "border-[rgb(var(--foreground-rgb)/0.30)] bg-[rgb(var(--foreground-rgb)/0.03)] hover:bg-[rgb(var(--foreground-rgb)/0.05)] hover:border-[rgb(var(--foreground-rgb)/0.45)]",

        className
      )}
    >
      {/* less space between blocks */}
      <div className="space-y-3">
        {/* Title */}
        <div className="leading-tight">
          <div className="text-1 text-[var(--gray)]">
            {data.title}
            {data.category ? <span>{" "}({data.category})</span> : null}
          </div>
        </div>

        {/* Severity pill — thinner */}
        <div>
          <span
            className={cx(
              "inline-flex items-center gap-2 rounded-full",
              "px-4 py-1.5",            // thinner pill
              "text-3 italic",          // keep your standardized size
              severityPillClasses(data.severity)
            )}
          >
            <span className="text-current">
              <CautionIcon />
            </span>
            {severityLabel(data.severity)} Severity Vulnerability
          </span>
        </div>

        {/* Message — less line spacing */}
        <p className="text-3 leading-snug text-[rgb(var(--gray-rgb)/0.60)]">
          {data.message}
        </p>

        {/* Location — icon has no border */}
        <div className="flex items-center gap-4 text-3 text-[var(--gray)]">
          <span className="inline-flex items-center justify-center text-[rgb(var(--gray-rgb)/0.90)]">
            <FileIcon />
          </span>
          <span className="truncate leading-tight">
            {data.filePath}{" "}
            <span className="text-[rgb(var(--gray-rgb)/0.90)]">(Line {data.line})</span>
          </span>
        </div>
      </div>
    </button>
  );
}
